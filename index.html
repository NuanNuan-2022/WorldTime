<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WorldTimeMap - Live Time</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    #searchBar {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    .countryBox {
      background: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
    }
    .countryName {
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .timeValue {
      font-size: 1.5em;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>World Time Viewer</h1>
  <input type="text" id="searchBar" placeholder="Search for a country...">
  <div id="countryGrid" class="grid"></div>

  <script>
    const countries = [
      { name: "Afghanistan", timeZone: "Asia/Kabul" },
      { name: "Albania", timeZone: "Europe/Tirane" },
      { name: "Algeria", timeZone: "Africa/Algiers" },
      { name: "Andorra", timeZone: "Europe/Andorra" },
      { name: "Angola", timeZone: "Africa/Luanda" },
      { name: "Argentina", timeZone: "America/Argentina/Buenos_Aires" },
      { name: "Armenia", timeZone: "Asia/Yerevan" },
      { name: "Australia", timeZone: "Australia/Sydney" },
      { name: "Austria", timeZone: "Europe/Vienna" },
      { name: "Azerbaijan", timeZone: "Asia/Baku" },
      { name: "Bangladesh", timeZone: "Asia/Dhaka" },
      { name: "Belarus", timeZone: "Europe/Minsk" },
      { name: "Belgium", timeZone: "Europe/Brussels" },
      { name: "Bhutan", timeZone: "Asia/Thimphu" },
      { name: "Brazil", timeZone: "America/Sao_Paulo" },
      { name: "Cambodia", timeZone: "Asia/Phnom_Penh" },
      { name: "Cameroon", timeZone: "Africa/Douala" },
      { name: "Canada", timeZone: "America/Toronto" },
      { name: "Chile", timeZone: "America/Santiago" },
      { name: "China", timeZone: "Asia/Shanghai" },
      { name: "Colombia", timeZone: "America/Bogota" },
      { name: "Cuba", timeZone: "America/Havana" },
      { name: "Czech Republic", timeZone: "Europe/Prague" },
      { name: "Denmark", timeZone: "Europe/Copenhagen" },
      { name: "Egypt", timeZone: "Africa/Cairo" },
      { name: "Finland", timeZone: "Europe/Helsinki" },
      { name: "France", timeZone: "Europe/Paris" },
      { name: "Germany", timeZone: "Europe/Berlin" },
      { name: "Greece", timeZone: "Europe/Athens" },
      { name: "India", timeZone: "Asia/Kolkata" },
      { name: "Indonesia", timeZone: "Asia/Jakarta" },
      { name: "Iran", timeZone: "Asia/Tehran" },
      { name: "Iraq", timeZone: "Asia/Baghdad" },
      { name: "Ireland", timeZone: "Europe/Dublin" },
      { name: "Israel", timeZone: "Asia/Jerusalem" },
      { name: "Italy", timeZone: "Europe/Rome" },
      { name: "Japan", timeZone: "Asia/Tokyo" },
      { name: "Kenya", timeZone: "Africa/Nairobi" },
      { name: "Mexico", timeZone: "America/Mexico_City" },
      { name: "Nigeria", timeZone: "Africa/Lagos" },
      { name: "Norway", timeZone: "Europe/Oslo" },
      { name: "Pakistan", timeZone: "Asia/Karachi" },
      { name: "Palestine", timeZone: "Asia/Gaza" },
      { name: "Philippines", timeZone: "Asia/Manila" },
      { name: "Poland", timeZone: "Europe/Warsaw" },
      { name: "Portugal", timeZone: "Europe/Lisbon" },
      { name: "Russia", timeZone: "Europe/Moscow" },
      { name: "Saudi Arabia", timeZone: "Asia/Riyadh" },
      { name: "South Africa", timeZone: "Africa/Johannesburg" },
      { name: "South Korea", timeZone: "Asia/Seoul" },
      { name: "Spain", timeZone: "Europe/Madrid" },
      { name: "Sweden", timeZone: "Europe/Stockholm" },
      { name: "Switzerland", timeZone: "Europe/Zurich" },
      { name: "Syria", timeZone: "Asia/Damascus" },
      { name: "Thailand", timeZone: "Asia/Bangkok" },
      { name: "Turkey", timeZone: "Europe/Istanbul" },
      { name: "Ukraine", timeZone: "Europe/Kyiv" },
      { name: "United Kingdom", timeZone: "Europe/London" },
      { name: "United States", timeZone: "America/New_York" },
      { name: "Vatican City", timeZone: "Europe/Vatican" },
      { name: "Vietnam", timeZone: "Asia/Ho_Chi_Minh" }
    ].sort((a, b) => a.name.localeCompare(b.name));

    const grid = document.getElementById('countryGrid');

    countries.forEach((country, index) => {
      const box = document.createElement('div');
      box.className = 'countryBox';
      box.innerHTML = `
        <div class="countryName">${country.name}</div>
        <div class="timeValue" id="time-${index}">Loading...</div>
      `;
      grid.appendChild(box);
    });

    function pad(n) { return n.toString().padStart(2, '0'); }

    async function fetchTime(zone) {
      const url = `https://opentimeapi.com/api/timezone/${encodeURIComponent(zone)}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error('API error');
      return res.json(); // 返回 { datetime: "...", timezone_name: ... }
    }

    async function updateAll() {
      countries.forEach((country, index) => {
        const el = document.getElementById(`time-${index}`);
        fetchTime(country.timeZone)
          .then(data => {
            const dt = new Date(data.datetime);
            const h = pad(dt.getHours()), m = pad(dt.getMinutes()), s = pad(dt.getSeconds());
            el.innerText = `${h}:${m}:${s}`;
          })
          .catch(() => el.innerText = 'Error');
      });
    }

    updateAll();
    setInterval(updateAll, 1000); // 每秒更新

    document.getElementById('searchBar').addEventListener('input', e => {
      const v = e.target.value.toLowerCase();
      Array.from(grid.children).forEach(child => {
        const name = child.querySelector('.countryName').innerText.toLowerCase();
        child.style.display = name.includes(v) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
